<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>â° é’Ÿè¡¨ç»˜ç”»æµ‹è¯•</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body { margin:0; padding:20px; font-family:sans-serif; text-align:center; background-color: #f9f9f9; }
h2 { margin-bottom: 10px; color: #333; }

    /* --- å¸ƒå±€å®¹å™¨ --- */
    .main-wrapper {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 20px;
        max-width: 1200px;
        margin: 0 auto;
        align-items: flex-start;
    }

    /* å·¦ä¾§ç»˜å›¾åŒºå®¹å™¨ */
    .drawing-section {
        flex: 1;
        min-width: 300px;
        max-width: 700px;
        display: flex;
        flex-direction: column;
        align-items: center;
    }

    /* å³ä¾§æ§åˆ¶åŒºå®¹å™¨ */
    .control-section {
        width: 340px;
        background: #fff;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        display: flex;
        flex-direction: column;
        align-items: center;
    }

    /* --- ç›®æ ‡æ—¶é—´æ˜¾ç¤ºæ ·å¼ --- */
    #target-time-display { 
        font-size:1.5em; 
        color:#d9534f; 
        font-weight:bold; 
        margin: 15px 0; 
        display: block;
        min-height: 1.5em; 
    }
    
    /* è¯´æ˜æ¡†æ ·å¼ */
    .instruction-box {
        background-color: #e7f3fe;
        border-left: 6px solid #2196F3;
        margin: 0 auto 20px auto;
        padding: 15px;
        text-align: left;
        border-radius: 4px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        width: 100%;
        box-sizing: border-box;
    }
    .instruction-box h3 { margin-top: 0; color: #0b5394; font-size: 1.2em; }
    .instruction-box p { margin: 8px 0; line-height: 1.6; color: #333; font-size: 14px; }
    .instruction-box strong { color: #d9534f; }
    
    /* Canvas æ ·å¼ */
    #canvas { 
        border: 2px solid #333; 
        background: #fff; 
        cursor: crosshair; 
        touch-action: none; 
        max-width: 100%; 
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        border-radius: 4px;
    }

    /* é€šç”¨æŒ‰é’®å®¹å™¨ */
    .toolbar {
        margin-top: 15px;
        margin-bottom: 15px;
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 8px;
        width: 100%;
    }

    /* é¢œè‰²æŒ‰é’®ä¸“ç”¨å®¹å™¨ (ç¡®ä¿ä¸‰ä¸ªæŒ‰é’®ä¸€æ’ç­‰å®½) */
    .color-toolbar {
        display: flex;
        justify-content: space-between;
        gap: 8px;
        width: 100%;
        margin-bottom: 15px;
    }

    /* é€šç”¨æŒ‰é’®æ ·å¼ */
    button {
        padding: 10px 12px;
        font-size: 14px;
        border: 1px solid #ccc;
        border-radius: 4px;
        cursor: pointer;
        transition: all 0.2s;
        background-color: #fff;
        color: #333;
        flex: 1 0 auto;
        min-width: 70px;
    }
    button:hover { background-color: #e9ecef; }
    button:active { transform: scale(0.98); }

    /* ç‰¹å®šæŒ‰é’®é¢œè‰² */
    .btn-clear { background-color: #ffc107; color: #333; border-color: #ffc107; }
    .btn-clear:hover { background-color: #e0a800; }
    .btn-undo { background-color: #6c757d; color: white; border-color: #6c757d; }
    .btn-undo:hover { background-color: #5a6268; }
    .btn-undo:disabled { opacity: 0.5; cursor: not-allowed; }

    /* é¢œè‰²æŒ‰é’®æ ·å¼è°ƒæ•´ */
    .color-toolbar button {
        flex: 1; /* å…³é”®ï¼šè®©ä¸‰ä¸ªæŒ‰é’®å¹³åˆ†å®½åº¦ */
        white-space: nowrap; /* é˜²æ­¢æ–‡å­—æ¢è¡Œ */
        overflow: hidden;
        text-overflow: ellipsis;
    }

    .btn-color-dial { border-bottom: 3px solid #000; font-weight: bold; }
    .btn-color-hour { border-bottom: 3px solid #dc3545; color: #dc3545; font-weight: bold; }
    .btn-color-minute { border-bottom: 3px solid #007bff; color: #007bff; font-weight: bold; }

    .btn-submit { 
        background: #007bff; 
        color: white; 
        border: none; 
        font-weight: bold;
        width: 100%;
        padding: 12px;
        font-size: 16px;
        margin-bottom: 15px;
    }
    .btn-submit:hover { background: #0056b3; }

    /* çŠ¶æ€ä¸ç»“æœæ¡† (ç§»è‡³å³ä¾§) */
    #status { 
        color: #666; 
        margin-bottom: 10px; 
        white-space: pre-wrap; 
        line-height: 1.5; 
        background: #fff; 
        padding: 10px; 
        border-radius: 4px; 
        width: 100%; 
        box-sizing: border-box;
        font-size: 14px; 
        border: 1px solid #eee;
    }
    #ai-result-box { 
        margin-top: 0; 
        padding: 20px; 
        border-radius: 8px; 
        font-size: 1.5em; 
        font-weight: bold; 
        display: none; 
        animation: fadeIn 0.5s ease-in-out; 
        box-shadow: 0 4px 12px rgba(0,0,0,0.15); 
        width: 100%; /* é€‚åº”å³ä¾§å®½åº¦ */
        box-sizing: border-box;
        word-wrap: break-word;
    }
    .result-success { background-color: #d4edda; color: #155724; border: 2px solid #c3e6cb; }
    .result-fail { background-color: #f8d7da; color: #721c24; border: 2px solid #f5c6cb; }
    .result-error { background-color: #fff3cd; color: #856404; border: 2px solid #ffeeba; font-size: 1em; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }

    /* --- ID è¾“å…¥åŒºç‰¹æœ‰æ ·å¼ --- */
    .id-input-display {
        width: 100%;
        padding: 12px;
        font-size: 24px;
        text-align: center;
        border: 2px solid #ccc;
        border-radius: 6px;
        margin-bottom: 10px;
        background: #f0f0f0;
        letter-spacing: 2px;
        box-sizing: border-box;
    }
    .id-input-display:focus {
        border-color: #007bff;
        outline: none;
        background: #fff;
    }
    .id-label {
        font-weight: bold;
        margin-bottom: 5px;
        display: block;
        color: #555;
    }

    /* ä¹å®«æ ¼é”®ç›˜ - ä¿®æ”¹ä¸ºé»˜è®¤æ˜¾ç¤º */
    .numpad {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 8px;
        width: 100%;
        margin-top: 10px;
        margin-bottom: 15px;
        border-top: 1px solid #eee;
        padding-top: 15px;
    }
    
    .num-btn {
        padding: 15px 0;
        font-size: 20px;
        background-color: #f8f9fa;
        border: 1px solid #ddd;
        border-radius: 6px;
        cursor: pointer;
        user-select: none;
    }
    .num-btn:active { background-color: #e2e6ea; }
    
    .num-btn-del { background-color: #ffc107; color: #333; font-weight: bold; border: none;}
    .num-btn-confirm { 
        background-color: #28a745; 
        color: #333; 
        font-weight: bold; 
        border: none;
    }

    /* åˆ†éš”çº¿ */
    .divider {
        width: 100%;
        height: 1px;
        background-color: #eee;
        margin: 15px 0;
    }

    /* å“åº”å¼è°ƒæ•´ */
    @media (max-width: 768px) {
        .main-wrapper { flex-direction: column; align-items: center; }
        .control-section { width: 100%; max-width: 666px; }
        .drawing-section { width: 100%; }
    }

    /* --- æ–°å¢ï¼šç¦ç”¨çŠ¶æ€æ ·å¼ --- */
    .disabled-btn {
        opacity: 0.5 !important;
        cursor: not-allowed !important;
        pointer-events: none !important; /* ç¦æ­¢é¼ æ ‡äº‹ä»¶ */
        filter: grayscale(100%);
    }
</style>
</head>
<body>

<h2>â° é’Ÿè¡¨ç»˜ç”»æµ‹è¯•</h2>

<div class="main-wrapper">

<!-- å·¦ä¾§ï¼šç»˜å›¾åŒºåŸŸ -->
<div class="drawing-section">
    <div class="instruction-box">
        <h3>æ“ä½œæŒ‡å—</h3>
        <p>è¯·åœ¨çª—å£å¤„ç”»ä¸€ä¸ªåœ†å½¢çš„é’Ÿè¡¨ï¼Œéœ€è¦ç”»å‡º<strong>è¡¨ç›˜å’Œ 12 ä¸ªåˆ»åº¦ä»¥åŠ 3,6,9,12 å››ä¸ªæ•°å­—</strong>ä»¥åŠ<strong>æ—¶é’ˆå’Œåˆ†é’ˆ</strong>ã€‚</p>
        <p>1. åœ¨å³ä¾§è¾“å…¥ ID å¹¶ç‚¹å‡»<strong>â€œç¡®è®¤â€</strong>è·å–é¢˜ç›®ã€‚</p>
        <p>2. ä½¿ç”¨å³ä¾§æŒ‰é’®åˆ‡æ¢ç”»ç¬”é¢œè‰²è¿›è¡Œç»˜ç”»ã€‚</p>
        <p>3. å®Œæˆåç‚¹å‡»å³ä¾§è“è‰²æŒ‰é’®<strong>â€œä¿å­˜å¹¶æäº¤â€</strong>ã€‚</p>
    </div>

    <p id="target-time-display">è¯·è¾“å…¥å³ä¾§ ID å¹¶å¼€å§‹</p>

    <canvas id="canvas" width="666" height="666"></canvas>
</div>

<!-- å³ä¾§ï¼šæ§åˆ¶åŒºåŸŸ (ID + æŒ‰é’® + ç»“æœ) -->
<div class="control-section">
    <!-- ID è¾“å…¥éƒ¨åˆ† -->
    <label class="id-label">è¯·è¾“å…¥å—è¯•è€… ID</label>
    <div class="id-input-display" id="idInput">ç‚¹å‡»è¾“å…¥ ID</div>
    
    <!-- æ•°å­—ä¹å®«æ ¼ -->
    <div class="numpad" id="numpad">
        <button class="num-btn" onclick="inputNumber('1')">1</button>
        <button class="num-btn" onclick="inputNumber('2')">2</button>
        <button class="num-btn" onclick="inputNumber('3')">3</button>
        <button class="num-btn" onclick="inputNumber('4')">4</button>
        <button class="num-btn" onclick="inputNumber('5')">5</button>
        <button class="num-btn" onclick="inputNumber('6')">6</button>
        <button class="num-btn" onclick="inputNumber('7')">7</button>
        <button class="num-btn" onclick="inputNumber('8')">8</button>
        <button class="num-btn" onclick="inputNumber('9')">9</button>
        <button class="num-btn num-btn-del" onclick="deleteNumber()">âŒ« åˆ é™¤</button>
        <button class="num-btn" onclick="inputNumber('0')">0</button>
        <button class="num-btn num-btn-confirm" onclick="confirmAndStart()">âœ… ç¡®è®¤</button>
    </div>

    <div class="divider"></div>

    <!-- ç»˜å›¾å·¥å…·æŒ‰é’® (æ¸…å±ã€æ’¤é”€) -->
    <div class="toolbar" id="toolToolbar">
        <button class="btn-clear" onclick="clearCanvasOnly()">ğŸ§¹ æ¸…å±</button>
        <button class="btn-undo" id="btnUndo" onclick="undoLastStroke()" disabled>â†©ï¸ æ’¤é”€</button>
    </div>

    <!-- é¢œè‰²æŒ‰é’® (è¡¨ç›˜ã€æ—¶é’ˆã€åˆ†é’ˆ - ä¸€æ’ç­‰å®½) -->
    <div class="color-toolbar" id="colorToolbar">
        <button class="btn-color-dial" onclick="setColor('#000000')">âš« è¡¨ç›˜</button>
        <button class="btn-color-hour" onclick="setColor('#dc3545')">ğŸ”´ æ—¶é’ˆ</button>
        <button class="btn-color-minute" onclick="setColor('#007bff')">ğŸ”µ åˆ†é’ˆ</button>
    </div>

    <!-- æäº¤æŒ‰é’® -->
    <button class="btn-submit" onclick="submitDrawing()" id="submitBtn">ğŸ’¾ ä¿å­˜å¹¶æäº¤</button>

    <!-- çŠ¶æ€æ˜¾ç¤º -->
    <p id="status"></p>
    
    <!-- ç»“æœæ¡† (æœ€åº•éƒ¨) -->
    <div id="ai-result-box"></div>
</div>
</div>

<script>
// ================= å…³é”®é…ç½® =================
const BACKEND_URL = "https://drawing-lsocfpcqtc.cn-beijing.fcapp.run";
// ===========================================

const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
const btnUndo = document.getElementById('btnUndo');
const submitBtn = document.getElementById('submitBtn');
const aiResultBox = document.getElementById('ai-result-box');
const statusEl = document.getElementById('status');
const timeDisplayEl = document.getElementById('target-time-display');

// ID è¾“å…¥ç›¸å…³å…ƒç´ 
const idInputDisplay = document.getElementById('idInput');

let isDrawing = false;
let targetTime = "";
let currentColor = '#000000';
let currentId = ""; // å½“å‰æ­£åœ¨è¾“å…¥çš„ ID

// ç”¨äºæ’¤é”€åŠŸèƒ½çš„æ ˆ
let historyStack = [];
const MAX_HISTORY = 20;
const TIME_OPTIONS = ["3:00", "6:00"];

// --- åˆå§‹åŒ– ---
window.onload = function() {
    clearCanvasOnly();
    historyStack = [];
    updateUndoButton();

    // æ¯æ¬¡æ‰“å¼€å¼ºåˆ¶æ¸…ç©º ID
    resetIdInput();
    
    // ã€é‡è¦ã€‘åˆå§‹åŒ–æ—¶ç¦ç”¨æ‰€æœ‰ç»˜å›¾ç›¸å…³æŒ‰é’®
    toggleButtons(false);
};

// --- ID è¾“å…¥é€»è¾‘ ---

function inputNumber(num) {
    if(currentId.length < 10) {
        currentId += num;
        updateIdDisplay();
    }
}

function deleteNumber() {
    currentId = currentId.slice(0, -1);
    updateIdDisplay();
}

function updateIdDisplay() {
    if(currentId === "") {
        idInputDisplay.textContent = "ç‚¹å‡»è¾“å…¥ ID";
        idInputDisplay.style.color = "#333";
    } else {
        idInputDisplay.textContent = currentId;
        idInputDisplay.style.color = "#333";
        idInputDisplay.style.borderColor = "#007bff";
    }
}

function confirmAndStart() {
    if(currentId === "") {
        alert("è¯·è¾“å…¥ ID åå†ç¡®è®¤ï¼");
        return;
    }

    // è§†è§‰åé¦ˆ
    idInputDisplay.style.color = "#28a745";
    idInputDisplay.style.borderColor = "#28a745";

    // ã€é‡è¦ã€‘ç¡®è®¤æˆåŠŸåï¼Œå¯ç”¨å…¶ä»–æŒ‰é’®
    toggleButtons(true);

    // å¼€å§‹ç»˜ç”»æµç¨‹
    startNewDrawing();
}

// æ¸…ç©º ID è¾“å…¥æ¡†çš„å‡½æ•°
function resetIdInput() {
    currentId = "";
    idInputDisplay.textContent = "ç‚¹å‡»è¾“å…¥ ID";
    idInputDisplay.style.color = "#333";
    idInputDisplay.style.borderColor = "#ccc";
    localStorage.removeItem('participant_id');
    
    // ã€é‡è¦ã€‘é‡ç½® ID æ—¶ï¼Œå†æ¬¡ç¦ç”¨å…¶ä»–æŒ‰é’®
    toggleButtons(false);
}

// --- æ ¸å¿ƒç»˜å›¾é€»è¾‘ ---

function getPos(e) {
    const rect = canvas.getBoundingClientRect();
    const clientX = e.touches ? e.touches[0].clientX : e.clientX;
    const clientY = e.touches ? e.touches[0].clientY : e.clientY;
    const scaleX = canvas.width / rect.width;
    const scaleY = canvas.height / rect.height;
    return {
        x: (clientX - rect.left) * scaleX,
        y: (clientY - rect.top) * scaleY
    };
}

const startDraw = (e) => {
    // åŒé‡æ£€æŸ¥ï¼šå¦‚æœè¿˜æ²¡ç¡®è®¤ IDï¼Œç¦æ­¢ç»˜ç”»ï¼ˆè™½ç„¶æŒ‰é’®å·²ç¦ç”¨ï¼Œä½†é˜²æ­¢ç›´æ¥æ“ä½œ Canvasï¼‰
    if (!targetTime) {
        alert("è¯·å…ˆè¾“å…¥ ID å¹¶ç‚¹å‡»ç¡®è®¤å¼€å§‹ï¼");
        return;
    }

    isDrawing = true;
    const pos = getPos(e);
    saveState();

    ctx.beginPath();
    ctx.moveTo(pos.x, pos.y);
    ctx.lineWidth = 5;
    ctx.lineCap = 'round';
    ctx.strokeStyle = currentColor;
};

const endDraw = () => {
    if (!isDrawing) return;
    isDrawing = false;
    ctx.closePath();
};

const moveDraw = (e) => {
    if (!isDrawing) return;
    e.preventDefault();
    const pos = getPos(e);
    ctx.lineTo(pos.x, pos.y);
    ctx.stroke();
};

canvas.addEventListener('mousedown', startDraw);
canvas.addEventListener('mouseup', endDraw);
canvas.addEventListener('mousemove', moveDraw);
canvas.addEventListener('mouseleave', endDraw);

canvas.addEventListener('touchstart', startDraw, {passive: false});
canvas.addEventListener('touchend', endDraw);
canvas.addEventListener('touchmove', moveDraw, {passive: false});

// --- åŠŸèƒ½å‡½æ•° ---

function saveState() {
    if (historyStack.length >= MAX_HISTORY) historyStack.shift();
    historyStack.push(canvas.toDataURL());
    updateUndoButton();
}

function updateUndoButton() {
    btnUndo.disabled = historyStack.length === 0;
}

function startNewDrawing() {
    const randomIndex = Math.floor(Math.random() * TIME_OPTIONS.length);
    targetTime = TIME_OPTIONS[randomIndex];

    timeDisplayEl.textContent = `è¯·ç”»å‡ºæ—¶é—´ï¼š${targetTime}`;

    clearCanvasOnly();
    historyStack = []; // æ¸…ç©ºå†å²
    updateUndoButton();

    aiResultBox.style.display = 'none';
    aiResultBox.className = '';
    statusEl.textContent = 'å·²å¼€å§‹æ–°å›åˆï¼Œè¯·ä½œç”»';
    setTimeout(() => { if(statusEl.textContent === 'å·²å¼€å§‹æ–°å›åˆï¼Œè¯·ä½œç”»') statusEl.textContent = ''; }, 2000);
}

function clearCanvasOnly() {
    // å¦‚æœæœªç¡®è®¤ IDï¼Œç¦æ­¢æ¸…å±
    if (!targetTime && currentId === "") {
        alert("è¯·å…ˆè¾“å…¥ ID å¹¶ç‚¹å‡»ç¡®è®¤å¼€å§‹ï¼");
        return;
    }
    ctx.fillStyle = "#FFFFFF";
    ctx.fillRect(0, 0, canvas.width, canvas.height);
}

function undoLastStroke() {
    if (historyStack.length === 0) return;
    const previousState = historyStack.pop();
    const img = new Image();
    img.src = previousState;
    img.onload = function() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.drawImage(img, 0, 0);
    };
    updateUndoButton();
}

function setColor(color) {
    // å¦‚æœæœªç¡®è®¤ IDï¼Œç¦æ­¢å˜è‰²
    if (!targetTime && currentId === "") {
        alert("è¯·å…ˆè¾“å…¥ ID å¹¶ç‚¹å‡»ç¡®è®¤å¼€å§‹ï¼");
        return;
    }
    currentColor = color;
}

async function submitDrawing() {
    if(!currentId && !idInputDisplay.textContent.includes("ç‚¹å‡»è¾“å…¥")) {
        currentId = idInputDisplay.textContent;
    }

    if(!currentId || currentId === "ç‚¹å‡»è¾“å…¥ ID") {
        alert("è¯·å…ˆåœ¨å³ä¾§è¾“å…¥ ID å¹¶ç‚¹å‡»ç¡®è®¤å¼€å§‹ï¼");
        document.querySelector('.control-section').scrollIntoView({behavior: "smooth"});
        return;
    }

    if (!targetTime) {
        alert("è¯·å…ˆç‚¹å‡»å³ä¾§çš„ã€ç¡®è®¤å¹¶å¼€å§‹ã€‘æŒ‰é’®è·å–é¢˜ç›®ï¼");
        return;
    }

    aiResultBox.style.display = 'none';
    aiResultBox.className = '';
    statusEl.textContent = 'æ­£åœ¨ä¸Šä¼ å¹¶ç­‰å¾… AI åˆ†æ...';
    statusEl.style.color = '#666';

    submitBtn.disabled = true;
    submitBtn.textContent = 'â³ åˆ†æä¸­...';

    const dataUrl = canvas.toDataURL('image/jpeg', 0.8);

    try {
        const response = await fetch(`${BACKEND_URL}/api/submit_task`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ 
                image_base64: dataUrl, 
                target_time: targetTime,
                participant_id: currentId 
            })
        });
        
        if (!response.ok) {
            const errText = await response.text();
            throw new Error(`æœåŠ¡å™¨é”™è¯¯ï¼š${response.status} - ${errText}`);
        }
        
        const data = await response.json();
        const aiResult = data.result; 
        const debugInfo = data.debug_info || {};

        aiResultBox.style.display = 'block';
        
        if (aiResult === "æ˜¯") {
            aiResultBox.innerHTML = `âœ… æ­£ç¡® <br><span style="font-size:0.6em; font-weight:normal">è¯·å‘Šè¯‰ AI åŠ©æ‰‹æ—¶é’Ÿç»˜ç”»æ­£ç¡®ã€‚</span>`;
            aiResultBox.className = 'result-success';
            statusEl.textContent = 'æäº¤æˆåŠŸï¼';
            statusEl.style.color = 'green';
        } else if (aiResult === "ä¸æ˜¯") {
            aiResultBox.innerHTML = `âŒ é”™è¯¯ <br><span style="font-size:0.6em; font-weight:normal">è¯·å‘Šè¯‰ AI åŠ©æ‰‹æ—¶é’Ÿç»˜ç”»é”™è¯¯ã€‚</span>`;
            aiResultBox.className = 'result-fail';
            statusEl.textContent = 'æäº¤æˆåŠŸï¼Œä½†æ—¶é—´ä¸å¯¹ã€‚';
            statusEl.style.color = '#d9534f';
        } else {
            aiResultBox.innerHTML = `âš ï¸ ç»“æœä¸æ˜ï¼š${aiResult || 'æœªçŸ¥'} <br><span style="font-size:0.6em; font-weight:normal">${debugInfo.ai_status || ''}</span>`;
            aiResultBox.className = 'result-error';
            statusEl.textContent = 'æäº¤æˆåŠŸï¼Œä½† AI æœªèƒ½æ˜ç¡®åˆ¤æ–­ã€‚';
            statusEl.style.color = '#856404';
        }
        
        // æäº¤æˆåŠŸåï¼Œæ¸…ç©º ID è¾“å…¥æ¡†å¹¶ç¦ç”¨æŒ‰é’®
        resetIdInput();
        
    } catch (error) {
        console.error(error);
        aiResultBox.style.display = 'block';
        aiResultBox.innerHTML = `âŒ è¿æ¥å¤±è´¥ <br><span style="font-size:0.6em; font-weight:normal">${error.message}</span>`;
        aiResultBox.className = 'result-error';
        statusEl.innerHTML = `âŒ <b>æäº¤å¤±è´¥</b>\n\né”™è¯¯ä¿¡æ¯ï¼š${error.message}`;
        statusEl.style.color = 'red';
        
        // å‡ºé”™åä¹Ÿé‡ç½® ID å¹¶ç¦ç”¨æŒ‰é’®
        resetIdInput();
    } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = 'ğŸ’¾ ä¿å­˜å¹¶æäº¤';
    }
}

// ã€æ–°å¢ã€‘æ§åˆ¶æŒ‰é’®å¯ç”¨/ç¦ç”¨çš„å‡½æ•°
function toggleButtons(isEnabled) {
    const toolButtons = document.querySelectorAll('#toolToolbar button');
    const colorButtons = document.querySelectorAll('#colorToolbar button');
    const submitButton = document.getElementById('submitBtn');
    
    const allButtons = [...toolButtons, ...colorButtons, submitButton];
    
    allButtons.forEach(btn => {
        if (isEnabled) {
            btn.classList.remove('disabled-btn');
            // å¦‚æœæ˜¯æ’¤é”€æŒ‰é’®ï¼Œä¿æŒå…¶åŸæœ‰çš„ disabled é€»è¾‘ï¼ˆå–å†³äºæ˜¯å¦æœ‰å†å²è®°å½•ï¼‰
            if(btn.id !== 'btnUndo') {
                btn.disabled = false;
            }
        } else {
            btn.classList.add('disabled-btn');
            btn.disabled = true;
        }
    });
}
</script>
</body>
</html>
